<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zelvora AI</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a1020">

<style>
:root{
  --bg:#050a15;
  --card:#0b1224;
  --border:#1e293b;
  --accent:#1f7aff;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}
header{
  padding:14px 16px;
  background:#0a1020;
  border-bottom:1px solid var(--border);
  font-weight:700;
}
main{
  padding:16px;
  padding-bottom:90px;
}
.modes{
  display:flex;
  gap:10px;
  overflow-x:auto;
  margin-bottom:14px;
}
.mode{
  padding:8px 14px;
  border-radius:20px;
  border:1px solid var(--border);
  background:var(--card);
  cursor:pointer;
  white-space:nowrap;
  font-size:14px;
}
.mode.active{
  background:var(--accent);
  border-color:var(--accent);
}
.chat-box{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  min-height:140px;
  margin-bottom:12px;
}
.message{
  margin-bottom:10px;
  font-size:15px;
}
.message.ai{color:#dbeafe}
.message.user{color:#a5f3fc}
.controls{
  display:flex;
  gap:10px;
}
input{
  flex:1;
  padding:12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#020617;
  color:white;
}
button{
  padding:12px 16px;
  border:none;
  border-radius:12px;
  background:var(--accent);
  color:white;
  font-weight:600;
  cursor:pointer;
}
.mic{
  background:#16a34a;
}
.mic.listening{
  background:#dc2626;
}
.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#020617;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-around;
  padding:10px 0;
  font-size:12px;
}
.bottom-nav div{
  color:var(--muted);
}
</style>
</head>

<body>

<header>Zelvora AI</header>

<main>
  <div class="modes" id="modes">
    <div class="mode active" data-mode="general">General</div>
    <div class="mode" data-mode="english">English</div>
    <div class="mode" data-mode="academic">Academic</div>
    <div class="mode" data-mode="exam">Exam</div>
    <div class="mode" data-mode="startup">Startup</div>
  </div>

  <div class="chat-box" id="chat">
    <div class="message ai">ðŸ‘‹ Hi, Iâ€™m Zelvora AI. Speak or type to start.</div>
  </div>

  <div class="controls">
    <input id="input" placeholder="Ask or speak..." />
    <button id="ask">Ask</button>
    <button id="mic" class="mic">ðŸŽ¤</button>
  </div>
</main>

<div class="bottom-nav">
  <div>Home</div>
  <div>Tutor</div>
  <div>English</div>
  <div>Academics</div>
  <div>Me</div>
</div>

<script>
/* ---------------- MODE HANDLING ---------------- */
let currentMode = "general";
document.querySelectorAll(".mode").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".mode").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentMode = btn.dataset.mode;
  }
});

/* ---------------- CHAT UI ---------------- */
const chat = document.getElementById("chat");
function addMsg(text,type){
  const div=document.createElement("div");
  div.className="message "+type;
  div.innerHTML=text;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

/* ---------------- AI REQUEST ---------------- */
async function askAI(text){
  addMsg(text,"user");
  addMsg("Thinkingâ€¦","ai");

  try{
    const res = await fetch(
      "https://zelvora-ai.zelvora-global.workers.dev",
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
          prompt:text,
          mode:currentMode
        })
      }
    );
    const data = await res.json();
    chat.lastChild.remove();
    addMsg(data.reply,"ai");
    speak(data.reply);
  }catch{
    chat.lastChild.remove();
    addMsg("âš ï¸ AI unavailable","ai");
  }
}

/* ---------------- TEXT INPUT ---------------- */
document.getElementById("ask").onclick=()=>{
  const v=input.value.trim();
  if(v) askAI(v);
  input.value="";
};

/* ---------------- VOICE (CONTINUOUS) ---------------- */
let recognition;
let listening=false;
let silenceTimer;

if("webkitSpeechRecognition" in window){
  recognition=new webkitSpeechRecognition();
  recognition.continuous=true;
  recognition.interimResults=true;
  recognition.lang="en-US";

  recognition.onresult=(e)=>{
    clearTimeout(silenceTimer);
    let text="";
    for(let i=e.resultIndex;i<e.results.length;i++){
      text+=e.results[i][0].transcript;
    }
    input.value=text;

    silenceTimer=setTimeout(()=>{
      recognition.stop();
      if(text.trim()) askAI(text.trim());
      listening=false;
      mic.classList.remove("listening");
    },1200);
  };
}

document.getElementById("mic").onclick=()=>{
  if(!recognition) return alert("Voice not supported");
  if(!listening){
    recognition.start();
    listening=true;
    mic.classList.add("listening");
  }else{
    recognition.stop();
    listening=false;
    mic.classList.remove("listening");
  }
};

/* ---------------- AI VOICE OUTPUT ---------------- */
function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  u.rate=0.9;
  speechSynthesis.speak(u);
}

/* ---------------- SERVICE WORKER ---------------- */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
