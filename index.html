<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Zelvora AI â€” Spoken English</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --primary:#4f8cff;
  --accent:#22d3ee;
  --danger:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  height:100vh;
  background:
    radial-gradient(circle at 20% 10%, #1e3a8a, transparent 40%),
    radial-gradient(circle at 80% 80%, #0ea5e9, transparent 40%),
    linear-gradient(180deg,#020617,#020617);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Inter,system-ui,-apple-system,sans-serif;
  color:#fff;
  overflow:hidden;
}

/* floating particles */
body::before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle,rgba(255,255,255,.08) 1px,transparent 1px);
  background-size:40px 40px;
  opacity:.15;
  animation: drift 60s linear infinite;
}

@keyframes drift{
  from{background-position:0 0}
  to{background-position:1000px 1000px}
}

.card{
  position:relative;
  width:92%;
  max-width:380px;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(20px);
  border-radius:26px;
  padding:26px;
  border:1px solid rgba(255,255,255,.18);
  box-shadow:0 30px 80px rgba(0,0,0,.55);
  animation: floatIn .8s ease;
}

@keyframes floatIn{
  from{transform:translateY(30px) scale(.96);opacity:0}
  to{transform:none;opacity:1}
}

h3{
  margin:0 0 6px;
  font-size:20px;
  font-weight:700;
  letter-spacing:.3px;
}

small{
  color:#94a3b8;
}

/* MIC */
.mic-wrap{
  display:flex;
  justify-content:center;
  margin:24px 0;
}

.mic{
  width:96px;
  height:96px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--primary),var(--accent));
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:36px;
  position:relative;
  box-shadow:0 0 0 0 rgba(79,140,255,.6);
}

.mic.listening{
  animation:pulse 1.8s infinite;
}

@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(79,140,255,.6)}
  70%{box-shadow:0 0 0 28px rgba(79,140,255,0)}
  100%{box-shadow:0 0 0 0 rgba(79,140,255,0)}
}

/* OUTPUT */
.output{
  background:rgba(0,0,0,.35);
  border-radius:16px;
  padding:14px;
  font-size:14px;
  line-height:1.5;
  min-height:64px;
  white-space:pre-wrap;
  transition:.3s;
}

/* BUTTONS */
.buttons{
  display:flex;
  gap:10px;
  margin-top:18px;
}

button{
  flex:1;
  border:none;
  border-radius:14px;
  padding:12px;
  font-weight:600;
  cursor:pointer;
  transition:.25s;
}

.start{
  background:linear-gradient(135deg,var(--primary),var(--accent));
  color:#001b2e;
}

.stop{
  background:rgba(239,68,68,.15);
  color:#fecaca;
  border:1px solid rgba(239,68,68,.4);
}

button:hover{transform:translateY(-1px)}
button:active{transform:scale(.97)}
</style>
</head>

<body>
<div class="card">
  <h3>ðŸŽ§ Zelvora AI</h3>
  <small id="status">Tap Start to speak</small>

  <div class="mic-wrap">
    <div class="mic" id="mic">ðŸŽ¤</div>
  </div>

  <div class="output" id="output">Waiting for your voiceâ€¦</div>

  <div class="buttons">
    <button class="start" onclick="restart()">Start</button>
    <button class="stop" onclick="stopAll()">Stop</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const API = "https://YOUR-WORKER-NAME.workers.dev";

/* ================= STATE ================= */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SR();
rec.continuous = true;
rec.interimResults = false;
rec.lang = "en-US";

let buffer = "";
let sendTimer = null;
let speaking = false;
let blocked = false;
let lastUserText = "";

/* ================= UI ================= */
const statusEl = document.getElementById("status");
const outputEl = document.getElementById("output");
const micEl = document.getElementById("mic");

/* ================= INPUT ================= */
rec.onresult = e => {
  if (speaking || blocked) return;

  const text = e.results[e.results.length - 1][0].transcript.trim();
  if (!text || text === lastUserText) return;

  lastUserText = text;
  buffer += " " + text;
  statusEl.textContent = "Listeningâ€¦";
  micEl.classList.add("listening");

  clearTimeout(sendTimer);
  sendTimer = setTimeout(sendToAI, 1600);
};

/* ================= BACKEND ================= */
async function sendToAI(){
  if (!buffer.trim()) return;

  const sendText = buffer.trim();
  buffer = "";
  statusEl.textContent = "Thinkingâ€¦";
  micEl.classList.remove("listening");

  try{
    const res = await fetch(API,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ text: sendText })
    });

    if (!res.ok) throw new Error();

    const data = await res.json();
    if (!data.reply) throw new Error();

    outputEl.textContent = data.reply;
    speak(data.reply);

  }catch{
    blocked = true;
    outputEl.textContent = "Connection issue. Tap Start to retry.";
    statusEl.textContent = "Stopped";
  }
}

/* ================= SPEAK ================= */
function speak(text){
  speechSynthesis.cancel();
  speaking = true;
  statusEl.textContent = "AI speakingâ€¦";

  const u = new SpeechSynthesisUtterance(text);
  u.rate = .95;

  u.onend = () => {
    speaking = false;
    statusEl.textContent = "Listeningâ€¦";
    micEl.classList.add("listening");
  };

  speechSynthesis.speak(u);
}

/* ================= SAFETY ================= */
rec.onend = () => {
  if (!speaking && !blocked) rec.start();
};

/* ================= CONTROLS ================= */
function restart(){
  blocked = false;
  buffer = "";
  lastUserText = "";
  statusEl.textContent = "Listeningâ€¦";
  micEl.classList.add("listening");
  rec.start();
}

function stopAll(){
  blocked = true;
  buffer = "";
  speechSynthesis.cancel();
  rec.stop();
  micEl.classList.remove("listening");
  statusEl.textContent = "Stopped";
}
</script>
</body>
</html>
