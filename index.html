<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zelvora AI</title>

<style>
body {
  margin: 0;
  background: #050a15;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
}
header {
  padding: 14px 16px;
  background: #0b1224;
  font-weight: 700;
}
#modes {
  display: flex;
  gap: 8px;
  padding: 10px;
  overflow-x: auto;
}
.mode {
  padding: 6px 14px;
  border-radius: 999px;
  background: #020617;
  border: 1px solid #1e293b;
  cursor: pointer;
  font-size: 13px;
}
.mode.active {
  background: #1f7aff;
  border-color: #1f7aff;
}
#chat {
  padding: 16px;
  height: calc(100vh - 220px);
  overflow-y: auto;
}
.msg {
  margin-bottom: 12px;
}
.user { color: #93c5fd; }
.ai { color: #dbeafe; }

#controls {
  display: flex;
  gap: 8px;
  padding: 12px;
  background: #020617;
  position: fixed;
  bottom: 0;
  width: 100%;
}
input {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #1e293b;
  background: #020617;
  color: white;
}
button {
  padding: 12px;
  border: none;
  border-radius: 10px;
  background: #1f7aff;
  color: white;
  font-weight: 600;
}
button.mic {
  background: #22c55e;
}
button.mic.listening {
  background: #dc2626;
}
</style>
</head>

<body>

<header>Zelvora AI</header>

<div id="modes">
  <div class="mode active" data-mode="general">General</div>
  <div class="mode" data-mode="english">English</div>
  <div class="mode" data-mode="academic">Academic</div>
  <div class="mode" data-mode="exam">Exam</div>
  <div class="mode" data-mode="startup">Startup</div>
</div>

<div id="chat">
  <div class="msg ai">ðŸ‘‹ Hi, Iâ€™m Zelvora AI. Tap mic or type.</div>
</div>

<div id="controls">
  <input id="input" placeholder="Speak or type..." />
  <button id="send">Send</button>
  <button id="mic" class="mic">ðŸŽ¤</button>
</div>

<script>
const WORKER_URL = "https://YOUR-WORKER-NAME.workers.dev"; // â† CHANGE THIS

let mode = "general";
document.querySelectorAll(".mode").forEach(m => {
  m.onclick = () => {
    document.querySelectorAll(".mode").forEach(x => x.classList.remove("active"));
    m.classList.add("active");
    mode = m.dataset.mode;
  };
});

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");
const micBtn = document.getElementById("mic");

function addMsg(text, cls) {
  const d = document.createElement("div");
  d.className = "msg " + cls;
  d.innerText = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

async function askAI(text) {
  addMsg(text, "user");
  addMsg("Thinking...", "ai");

  try {
    const res = await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt: text, mode })
    });
    const data = await res.json();
    chat.lastChild.remove();
    addMsg(data.reply, "ai");
    speak(data.reply);
  } catch {
    chat.lastChild.remove();
    addMsg("AI unavailable. Please try again.", "ai");
  }
}

sendBtn.onclick = () => {
  if (input.value.trim()) askAI(input.value.trim());
  input.value = "";
};

// ---- VOICE (CONTINUOUS) ----
let recognition;
let listening = false;
let silenceTimer;

if ("webkitSpeechRecognition" in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = "en-IN";
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = e => {
    clearTimeout(silenceTimer);
    let text = "";
    for (let i = e.resultIndex; i < e.results.length; i++) {
      text += e.results[i][0].transcript;
    }
    input.value = text;
    silenceTimer = setTimeout(() => {
      recognition.stop();
      listening = false;
      micBtn.classList.remove("listening");
      askAI(text.trim());
    }, 1200);
  };
}

micBtn.onclick = () => {
  if (!recognition) return alert("Voice not supported");
  listening = !listening;
  micBtn.classList.toggle("listening", listening);
  listening ? recognition.start() : recognition.stop();
};

// ---- SPEAK BACK ----
function speak(text) {
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-IN";
  u.rate = 0.9;
  speechSynthesis.speak(u);
}
</script>

</body>
</html>
